<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>BM Files</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<OBJECT TYPE="application/x-oleobject" CLASSID="clsid:1e2a7bd0-dab9-11d0-b93a-00c04fc99f9e">
	<PARAM NAME="Keyword" VALUE="BM Files">
	<PARAM NAME="Keyword" VALUE="file format">
</OBJECT>

<H4><A NAME="da7phk"></A>BM FILES</H4>

<P>BM files store textures used in a variety of ways in DF.</P>

<P>They serve as wall textures, as floor and ceiling textures (in which case they must be 64*64), as 3DO facet textures, as weapons, and as the Heads Up Display.</P>

<P>Here is the data structure for the BM file header.</P>

<P>BM_Header IS</P>

<P>{</P>

<TABLE cols=3 width=593>

<TR VALIGN="top">
<TD width=20%>MAGIC</TD>
<TD width=16%>char[4]</TD>
<TD width=64%>// = 'BM ' + 0x1E</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> SizeX</TD>
<TD width=16%>int</TD>
<TD width=64%>// if = 1 then multiple BM in the file</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> SizeY</TD>
<TD width=16%>int</TD>
<TD width=64%>// EXCEPT if SizeY also = 1, in which case<BR>
// it is a 1x1 BM</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> idemX</TD>
<TD width=16%>int</TD>
<TD width=64%>// unused by engine</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> idemY</TD>
<TD width=16%>int</TD>
<TD width=64%>// unused by engine</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> Transparent</TD>
<TD width=16%>byte</TD>
<TD width=64%>// 0x36 for normal<BR>
// 0x3E for transparent<BR>
// 0x08 for weapons</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> logSizeY</TD>
<TD width=16%>byte</TD>
<TD width=64%>// logSizeY = log2(SizeY)<BR>
// logSizeY = 0 for weapons</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> Compressed</TD>
<TD width=16%>int</TD>
<TD width=64%>// 0 = not compressed
<P>// 1 = compressed (RLE)</P>

<P>// 2 = compressed (RLE0)</P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> DataSize</TD>
<TD width=16%>long</TD>
<TD width=64%>// Data size for compressed BM
<P>// excluding header and columns starts table</P>

<P>// If not compressed, DataSize is unused</P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=20%> pad1</TD>
<TD width=16%>byte[12]</TD>
<TD width=64%>// 12 times 0x00</TD>
</TR>
</TABLE><BR>

<P>}</P>

<P>Please note that BM must have height and width which are powers of 2 (except weapons).</P>

<P>The data follows, encoded by COLUMNS from the bottom to the top.</P>

<P>See also:</P>

<P><A HREF="df_s488l.htm">Transparent BM</A></P>

<P><A HREF="df_s13lh.htm">Multiple BM</A></P>

<P><A HREF="df_s13li.htm">Compressed BM</A></P>

</BODY>
</HTML>
